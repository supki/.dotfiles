function chpwd {
	print -Pn "\e]2;%~\a"
}

autoload -U compinit promptinit colors
autoload -Uz vcs_info

autoload -U zrecompile
zrecompile -pq ~/.zshrc
zrecompile -pq ~/.zshenv

fpath=(/opt/devtools-1.0/completions/zsh ~/git/zsh-completions/src $fpath)
compinit
setopt autocd autopushd correct
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zsh/cache
zstyle ':completion:*:descriptions' format '%U%B%d%b%u'
zstyle ':completion:*:warnings' format '%BSorry, no matches for: %d%b'

setopt prompt_subst
zstyle ':vcs_info:*' check-for-changes true
zstyle ':vcs_info:*' stagedstr '×'
zstyle ':vcs_info:*' unstagedstr '×'
zstyle ':vcs_info:svn:*' formats "%F{3}%b%f"
zstyle ':vcs_info:git:*' formats "%F{1}%u%f%F{2}%c%f %F{3}%b%f"
zstyle ':vcs_info:*' enable git svn

function vcs_info_wrapper {
  vcs_info
  if [ -n "$vcs_info_msg_0_" ]; then
    echo "%{$fg[grey]%}${vcs_info_msg_0_}%{$reset_color%}$del"
  fi
}

promptinit
colors
PROMPT="%F{blue}%n%f@%M:%F{yellow}%~%(?,%F{green},%F{red})%#%f "
PROMPT2="%F{blue}%_%f> "
RPROMPT=$'$(vcs_info_wrapper)'

chpwd

HISTSIZE=10000
HISTFILE=~/.zhistory
SAVEHIST=10000

setopt histignorealldups
setopt histignorespace

setopt autocd

setopt interactivecomments

bindkey -v
bindkey '^[[A' history-beginning-search-backward
bindkey '^[[B' history-beginning-search-forward
bindkey -a 'k' history-beginning-search-backward
bindkey -a 'j' history-beginning-search-forward
bindkey '^?' backward-delete-char
bindkey '^[[3~' delete-char
bindkey "^[[7~" beginning-of-line
bindkey "^[[8~" end-of-line
bindkey "^[[1~" beginning-of-line
bindkey "^[[4~" end-of-line
bindkey "^_" undo
bindkey -a "'" quote-line
bindkey -a "q" push-line
bindkey "^[[Z" reverse-menu-complete

alias ack=ack-grep # stupid debian
alias ls='ls --color'
alias fap='fab'
alias less='less -R'
alias lens='ghci'
alias ghciu='ghci -ignore-dot-ghci'
alias ka='killall'
alias b='biegunka'
alias c='cabal'
alias g='git'
alias s='svn'
alias m='vim'

function man {
	/usr/bin/man $@ 2>&1 | vim -c 'set ft=man nomod' -c 'nmap q :qa!<CR>' -
}

function :t {
	ghc -e ":t $@"
}

function haddock-global {
	package=$1
	for index in /usr/local/share/doc/ghc/html/libraries/${package}-*/index.html; do
		xdg-open file://${index}
	done
}
function haddock-local {
	package=$1
	for index in ${HOME}/.cabal/share/doc/${package}-*/html/index.html; do
		xdg-open file://${index}
	done
}
function haddock-dist {
	for index in dist/doc/html/*/index.html; do
		xdg-open file://$(pwd)/${index}
	done
}
function haddock-sandbox {
	for index in dist/dist-sandbox-*/doc/html/*/index.html; do
		xdg-open file://$(pwd)/${index}
	done
}
function haddock-dev {
	package=$1
	for index in cabal-dev/share/doc/${package}-*/html/index.html; do
		xdg-open file://$(pwd)/${index}
	done
}

function insert_sudo {
	zle beginning-of-line
	zle -U "sudo "
}

zle -N insert-sudo insert_sudo
bindkey "^[z" insert-sudo

function back_to_vim {
	fg
}

zle -N back-to-vim back_to_vim
bindkey -a "^z" back-to-vim
bindkey -v "^z" back-to-vim

function xrandr-work {
	xrandr --auto --output VGA-1 --mode 1280x1024 --right-of DVI-I-1
}

ssh-add 2>/dev/null # add my identity to ssh-agent and don't tell me about this, thanks

compdef _cabal cabal-dev

source ~/git/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

export NO_SCRIPTS_NOTIFICATIONS=yes

# OPAM configuration
. /home/maksenov/.opam/opam-init/init.zsh > /dev/null 2> /dev/null || true
